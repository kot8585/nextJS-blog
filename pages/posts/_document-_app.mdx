---
title: "\_document와 \_app"
date: "2023-03-07"
category: nextJs
---

import PostLayout from "@/components/PostLayout";

export const meta = {
  title: "A post with figures and video",
  createdAt: "18th June 2019",
  readTime: 2,
};

export default ({ children }) => (
  <PostLayout meta={meta}>{children}</PostLayout>
);

# 목차

- \_document는 무엇인지
- 서버에서 실행된다는 것이 무엇인지, 왜 browser API를 가져올 수 없는지
- nextJS에서는 어떤 것까지 서버사이드 렌더링이야? useEffect가 돌긴하는거야? 그리고 context도 서버사이드로 도는거야?

# \_app

서버로 요청이 들어왔을 때 가장 먼저 실행되는 컴포넌ㅌㅡ, 페이지에 적용할 공통 레이아웃의 역할

componentDidMount
lazy initial state.
//https://dev.to/tusharshahi/react-nextjs-dark-mode-theme-switcher-how-i-fixed-my-flicker-problem-5b54

light 모드에서 새로고침 시 localstorage에서 theme을 가져오기 전에 dark 모드로 설정되어 있다가 다시 light로 설정되므로 깜박이는 현상이 있어 이 부분을 \_document.tsx 에서 미리 설정될 수 있도록 했다.

돔 요소들을 띄우기 전에 테마가 무엇인지 파악하여 모드를 설정한다.

## \_document

- 서버에서만 렌더링된다.
- 그래서 localStorage를 사용할 수 없다그랬는데 어떻게 한거지?
- nextJS에서 useEffect는 어떻게 동작해?
- 파일은 서버측에서 실행된다. -> 서버측에서 실행된다는게 무슨뜻이야?

## 깜빡임 원인

- nextJS가 처음 렌더링 할때는 window의 값을 읽을 수 없으므로 default인 false로 설정된다.
- 그 이후(이걸 가르키는게 뭐야?)에 새로 로드되면서? useEffect가 돌면서? window를 읽을 수있게되는데 이때 올바른 darkMode가 설정되면서 다시 렌더링이 된다.
- useEffect는 componentDidMount처럼 작동한다...?
- useEffect랑 관련이 있는거야?
- 테마를 변경하는 과정이 Dom Tree가 구성된 후 자바스크립트 파일을 파싱한 후에 이루어졌다..?
- 서버렌더링이 일어날 시 에는 브라우저 API를 참조할 수 없기 때문에 기본값 설정
- 마운트 되고 나서 변경된다.

## 해결방법

- DOM이 그려지기 전에 javascript에 올바른 변수를 설정해준다..?

### 하나씩 해보자..

- nextJS의 렌더링 과정과 \_document의 상관관계
- 렌더링 과정에서 (HTML파싱 -> CSS 파싱 -> DOM, CSSOM 트리생성 -> 렌더트리생성 -> 레이아웃 -> 페인트) 클라이언트가 돌때 어디부터 다시 실행?
- 서버사이드에서 만든다는건 페인트까지 해서 미리 저장한다는거야? 서버측에서 실행된다는게 무슨뜻

## 리액트의 동작원리

- 리액트는 컴포넌트들의 집합체이다.
- 사용자와 interaction해서 state를 업데이트하고 변경된 상태를 가진 컴포넌트만 업데이트한다.
- 1. 브라우저에서 HTML을 DOM TREE로 변환
  - DOM은 무엇이고 DOM TREE는 무엇인가
- 2. 리액트는 가상의 Dom Tree를 가지고 있어서 이전의 virtual Dom Tree와 비교해서 변경된 부분만 Dom Tree를 업데이트한다.

## 대채채채채채채

- render : 가상 DOM을 그리는 과정
- mount : 화면에 DOM이 그려지는것 (Paint?)
- useLayoutEffect는 render이후 mount이전에 실행이 되고
- useEffect는 mount이후 실행이 된다. 그래서 useEffect에서 setState를 하면 리렌더링이 일어난다.
