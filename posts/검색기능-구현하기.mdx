---
title: "검색기능 구현하기"
date: "2023-03-09"
category: nextJs
---

# react-query를 써야하는 경우와 getStaticProps를 사용해야 하는 경우

react-query를 사용해야 하는 경우는 사용자의 요청에 따라 데이터가 달라질 경우 -> 사용자에 따른 todoList, 사용자 대시보드, 장바구니
getStaticProps를 사용해야 하는 경우는 상품 목록 같은 것들

# 서버에서 실행된다는 것과 클라이언트에서 실행된다는 것의 차이.

서버에서 실행된다 : CDN에 캐시된다.
클라이언트에서 실행된다 : 클라이언트에서 캐시된다.

# 다른 페이지에서 getStaticProps를 써도 똑같은 데이터를 가지고 오는거야? **괜찮은거야??** index에서 캐시된 데이터를 가져오는 방법은? 그러니까 서버에서 캐시 구조는,,,은 상관없지 않나? 어차피 서버자나. 근데 이거 서버에 부담이 많이 간댔는데. 서버가 내 서버를 말하는건 아니지?

# getStaticPaths?? getStaticProps??

# static sites

- 서버에 이미 잘 만들어진 html 문서들이 있고 사용자가 브라우저에서 url을 검색하면 서버에서 이미 만들어진 HTML 문서를 받아와서 보여주는 형식
- 문제점 : 다른 url로 이동한다면 서버에서 전체를 다시 받아와야 해서 깜빡거림

# SPA

- 사용자가 한페이지에서 머무르면서 필요한 데이터만 가져와 부분적으로 업데이트를 한다.
- FETCH같은 api를 통해 필요한 데이터만 JSON포맷으로 가져옴. 그 데이터를 javascript를 이용해 동적으로 html을 생성해서 브라우저에 보여준다.
- 그러면 자바스크립트는 동적으로 HTML을 생성하기 위해 만들어진건가? 그게 자바스크립트의 역할?
- 처음에 기본 HTML보여준다음에 JAVASCRIPT로 부분적으로 업데이트...? html파싱이 멈춘다는건 뭐야?

# CSR

- HTML은 텅텅 비어져있어서 처음에 접속하면 빈 화면만 보인다.
- 다시 링크된 app.js를 서버로부터 다운로드 받는데 여기에는 자바스크립트 뿐만 아니라 어플리케이션을 구동하는 프레임워크와 라이브러리의 소스코드들도 다 포함되어 있어 사이즈가 커서 다운로드 받는데 오래걸린다.
- 추가로 필요한 데이터가 있다면 서버에 요청해서 데이터를 받아온 다음에 이것들을 기반으로 동적으로 HTML을 생성해서 클라이언트에게 보여준다.
- 문제점 : 사용자가 첫 화면을 보기까지 시간이 오래걸릴 수 있다. SEO도 좋지않다.
- 흐름
  - 사용자가 사이트에 접속
  - 서버에게서 텅텅빈 index.js 받아온다. (HTML???)
  - index.html파일에 링크되어져 있는 웹사이트에서 필욯한 모든 로직이 담겨있는 자바스크립트를 요청한다.
  - 모든 자바스크립트 파일을 가져오게 된다면 화면이 보여지게 되고 interaction을 할 수있게 된다.
  - TTV(사용자에게 화면이 보여지는 시간)과 TTI(사용자가 interaction을 할 수 있는 시간)이 같다.
  - 최종적으로 번들링해서 사용자에게 보내주는 이 자바스크립트 파일을 어떻게 하면 효율적으로 분할해서 첫번째로 사용자가 보기위해 필요한 필수적인 것만 보낼 수 있는지 고민해야 한다.

# SSR

- 웹사이트에 접속하면 서버에서 필요한 데이터(index, data)를 모두 가져와 HTML파일을 만들어 동적으로 조금 제어할 수 있는 소스코드(code splitting?)와 함께 클라이언트에게 보내준다.
- 첫번쨰 페이지로딩이 빠르다.
- 효율적인 SSR
- 문제점 : 깜빡임 존재, 서버에 과부하가 걸리기 쉬움
- 사용자가 클릭을 할때마다 서버에서 필요한 데이터를 가지고 와서 HTML을 만들어야하므로 서버에 과부하
- 클릭했는데 반응이 없을 수 있다.
- TTV TTI 시간의 단차를 줄이기 위해 어떻게 단차를 줄일 수 있을지 고민해봐야한다.

### SSG

- 리액트로 만든 웹어플리케이션을 정적으로 미리 생성해놓아서 서버에 배포해놓는다.
- 이렇게 만들어진 웹사이트는 모두 정적인건 아니다.
- 추가적으로 데이터를 서버에서 가져오거나 동적으로 처리해야 하는 로직이 있다면 자바스크립트 파일을 함께 가지고 있을 수 있기 때문에 동적인 요소도 추가 가능

### getStaticPAths

- getStaticPaths 함수를 export하면 Next.js는 모든 getSTaticPaths에 정의된 모든 경로를 pre-render 한다.
  동적경로에서 사용되는거 같은데...
  동적라우팅 + getStaticProps를 원할 때 사용한다. 페이지가 동적 라우팅을 쓰고 있고, getStaticProps를 쓰는 경우, getStaticPaths을 통해 빌드 타임 때 정적으로 렌더링할 경로를 설정해야 한다. 여기서 정의하지 않은 하위 경로는 접근해도 화면이 뜨지 않는다. 동적라우팅 할 때, 라우팅 되는 경우의 수를 하나하나 집어넣어야 한다.

### getStaticProps

- getStaticPaths는 getStaticProps를 필요로 한다.
- getStaticPaths를 통해 가져온 경로로 getStaticProps를 통해 모든 데이터를 pre-render해놓기 때문에?
- "빌드 시에 딱 한 번"만 호출되고, 바로 static file로 빌드되어, 빌드 이후 수정이 불가능하다.
- getStaticProps는 revalidate이라는 옵션을 통해 주기적으로 데이터를 패칭하여 SSG와 SSR의 장점이 합쳐진 ISR을 구현할 수 있다.

## getServerSideProps

- getServerSideProps는 빌드와 상관없이, page가 요청받을때마다" 호출되어 pre-rendering한다.
